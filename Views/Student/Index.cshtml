@model AttendenceManagementSystem.ViewModels.StudentDashboardViewModel

@{
    ViewData["Title"] = "Student Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container mt-4">
    <!-- Student Info Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="mb-2">
                                <i class="bi bi-mortarboard-fill text-primary"></i> @Model.StudentName
                            </h3>
                            <p class="mb-1">
                                <strong>Roll Number:</strong> <span class="badge bg-success">@Model.RollNumber</span>
                                <strong class="ms-3">Batch:</strong> <span class="badge bg-info text-dark">@Model.BatchName</span>
                                <strong class="ms-3">Section:</strong> <span class="badge bg-warning text-dark">@Model.SectionName</span>
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="card bg-light border-0">
                                <div class="card-body p-3">
                                    <h6 class="text-muted mb-1">Overall Attendance</h6>
                                    <h2 class="mb-0 @(Model.OverallAttendancePercentage >= 80 ? "text-success" : Model.OverallAttendancePercentage >= 70 ? "text-warning" : "text-danger")">
                                        @Model.OverallAttendancePercentage%
                                    </h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card text-white bg-primary h-100">
                <div class="card-body text-center">
                    <i class="bi bi-book-half" style="font-size: 2.5rem;"></i>
                    <h3 class="mt-2 mb-0">@Model.TotalSubjects</h3>
                    <p class="mb-0">Enrolled Subjects</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-white bg-success h-100">
                <div class="card-body text-center">
                    <i class="bi bi-check-circle-fill" style="font-size: 2.5rem;"></i>
                    <h3 class="mt-2 mb-0">@Model.EnrolledSubjects.Sum(s => s.PresentCount)</h3>
                    <p class="mb-0">Classes Attended</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-white bg-danger h-100">
                <div class="card-body text-center">
                    <i class="bi bi-x-circle-fill" style="font-size: 2.5rem;"></i>
                    <h3 class="mt-2 mb-0">@Model.EnrolledSubjects.Sum(s => s.AbsentCount)</h3>
                    <p class="mb-0">Classes Missed</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Subject Cards Section -->
    <div class="row mb-3">
        <div class="col-12">
            <h4><i class="bi bi-journal-text"></i> My Subjects</h4>
            <hr />
        </div>
    </div>

    @if (Model.EnrolledSubjects.Any())
    {
        <div class="row">
            @foreach (var subject in Model.EnrolledSubjects)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-book"></i> @subject.SubjectCode
                            </h5>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title">@subject.SubjectName</h6>
                            <p class="card-text text-muted mb-2">
                                <i class="bi bi-person-fill"></i> @subject.TeacherName
                            </p>
                            
                            <hr />
                            
                            <!-- Statistics -->
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span><strong>Attendance:</strong></span>
                                    <span class="badge @subject.StatusBadge">@subject.StatusText</span>
                                </div>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar @subject.ProgressBarColor" role="progressbar" 
                                         style="width: @subject.AttendancePercentage%" 
                                         aria-valuenow="@subject.AttendancePercentage" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        <strong>@subject.AttendancePercentage%</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="row text-center mb-3">
                                <div class="col-4">
                                    <small class="text-muted">Total</small>
                                    <h5 class="mb-0">@subject.TotalClasses</h5>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Present</small>
                                    <h5 class="mb-0 text-success">@subject.PresentCount</h5>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Absent</small>
                                    <h5 class="mb-0 text-danger">@subject.AbsentCount</h5>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <a asp-action="Details" asp-route-id="@subject.EnrollmentId" class="btn btn-primary btn-sm w-100">
                                <i class="bi bi-file-text"></i> View Full Report
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> 
            <strong>No enrollments found.</strong> You are not enrolled in any subjects yet. Please contact your administrator.
        </div>
    }
</div>
